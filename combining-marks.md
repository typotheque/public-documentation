# Combining marks

## What is a combining mark?

In font production, a _combining mark_ (or simply _mark_) is a non-spacing glyph that’s meant to be positioned on a preceding glyph. The opposite is a _base_ glyph, which is spacing.

> Unicode is about characters instead of glyphs. In Unicode, some [combining mark characters](https://unicode.org/reports/tr44/#General_Category_Values) are spacing, and therefore they’re implemented in fonts as base glyphs instead of marks. For example, many vowel signs in Indic scripts are spacing combining mark characters.

## How should source files be maintained?

### Use mark glyphs in composites

Some diacritics have both a spacing character and a nonspacing combining mark character. For example, U+0060 ` GRAVE ACCENT and U+0300 ◌̀ COMBINING GRAVE ACCENT. Such a pair of characters should map to separate glyphs in a source file.

How accented letters are composed from components should be consistent with how they’re encoded. Therefore, create the component from the combining mark glyph.

> An accented letter is essentially a ligature of the base letter and one or more combining marks. The spacing characters have nothing to do with accented letters, and are only used when displaying a diacritic in isolation.

### Make mark glyphs recognizable for production

Because zero-width glyphs are difficult to handle in font editors, it’s common practice to draw marks as spacing glyphs in source files and have their widths zeroed in production. This can be controlled with anchoring:

- If a glyph has a mark anchor (an anchor with a “\_”-prefixed name), it is recognized as a mark in production and will get its width zeroed.

- A glyph may rely on a mark anchor for automatic alignment in Glyphs, but should not be recognized as a mark in production. To suppress the mark recognization, use the Glyphs app’s anchor naming convention of the “#” prefix.

> For example, `periodcentered` (U+00B7 · MIDDLE DOT) often suffers from this issue because of its anchor pair “(\_)center” with `L` and `l`. Rename the anchor pair to “(\_)#center”. Note “#” is inserted after the mark anchor’s “\_” prefix.

### Simplify spacing and alignment

Because a mark glyph’s width in source will be zeroed anyway, it may be beneficial if all mark glyphs in a source file use a single dummy width and a simple strategy for horizontally positioning their outlines, which eliminates unnecessary decision making. For example:

- Just always use the default glyph width in Glyphs, 600 units. Or, sync the width with `space`.

- Instead of trying to center the outlines in the glyph width and adjust the mark anchor’s position, always place the mark anchor on the y axis (x = 0) and move outlines in relation to the anchor.

### More about anchoring

Additional notes about anchoring:

- All base glyphs, in particular letter-like glyphs, should by default have “top” and “bottom” anchors.

- When a mark glyph (eg, `gravecomb`) is assigned a base anchor (`top`) for mark-to-mark positioning, that base anchor should typically be horizontally aligned to the existing mark anchor (`_top`). In other words, the two anchors should have the same x value.

> This is because this mark and its following mark should typically be horizontally aligned to the base glyph in the same way. Otherwise a stack of marks will unexpected tilt sideways from the base.

## How does Glyphs behave?

It’s helpful to understand how Glyphs behaves in terms of mark glyphs, because we do export fonts from it for quick testing.

Glyphs zeroes glyph widths and sets GDEF classes according to its internally tracked “glyph info”, instead of mark anchors. The eventual “glyph info” is resolved from:

- the app’s built-in GlyphData.xml
  - Can be examined in Window menu → Glyph Info.
- overrides from the source file’s external [custom GlyphData.xml](https://glyphsapp.com/learn/roll-your-own-glyph-data)
  - Which, surprisingly, doesn’t affect what’s shown in the Glyph Info window.
- further overrides stored in the source file
  - Edit menu → Info for Selection

Both font binaries and master UFOs exported from Glyphs are affected.

Because this mechanism is complicated to maintain, our production workflow is by design _not_ affected by it. The UFOs we use in production is generated by [glyphsLib](https://github.com/googlefonts/glyphsLib), which does try to mimic the Glyphs app’s behavior by default, but it allows us to recover a glyph’s original width in case it’s been zeroed.

## Production and shaping details

For anchoring to actually work in shaping, a mark glyph needs to be assigned to the GDEF table’s [class 3 (mark)](https://learn.microsoft.com/en-us/typography/opentype/spec/gdef#glyph-class-definition-table). Just like width zeroing, this is handled in production for all recognized mark glyphs.

For most scripts, the width of a GDEF mark is zeroed in shaping. Scripts like Telugu, however, get the widths of their GDEF mark glyphs preserved, which enables some advanced OpenType Layout techniques.
